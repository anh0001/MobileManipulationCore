# Policy model configuration parameters

policy:
  # Model selection
  model_name: "openvla-7b"  # Options: openvla-7b, openvla-1b, custom
  model_path: ""  # Local path to model, empty to download from HuggingFace

  # Inference settings
  inference_rate: 0.5  # Hz (how often to run policy)
  max_steps: 50        # Number of steps per prompt; set <=0 to run continuously until prompt is cleared
  task_prompt_topic: "/manipulation/task_prompt"  # Topic used by task_prompt_cli and policy node
  batch_size: 1
  device: "cuda"  # cuda, cpu, or specific device like cuda:0
  reference_frame: ""  # Optional action reference frame override; empty -> use arm_base_frame

  # Model optimization
  use_fp16: true  # Use half-precision for faster inference
  use_tensorrt: false  # Convert to TensorRT (Jetson optimization)
  compile_model: false  # Use torch.compile (PyTorch 2.0+)

  # Input preprocessing
  image_size: [224, 224]  # Width, height for model input
  normalize_image: true
  mean: [0.485, 0.456, 0.406]  # ImageNet normalization
  std: [0.229, 0.224, 0.225]

  # Output post-processing
  action_scaling_xyz: 10.0  # Gain applied to OpenVLA xyz delta outputs
  action_scaling_rotation: 10.0  # Gain applied to OpenVLA roll/pitch/yaw delta outputs
  clip_actions: true
  action_bounds:
    position: [-1.0, 1.0]
    rotation: [-3.14, 3.14]
    gripper: [0.0, 1.0]

# Remote inference settings (for split deployment)
remote:
  enabled: true
  server_url: "http://100.112.100.20:30542"
  timeout: 10.0  # seconds (safer for remote OpenVLA inference)
  retry_attempts: 1  # avoid long retry chains that fall back to stub
  fallback_on_failure: false  # Safety: never send stub actions when remote inference fails

# Observation configuration
observation:
  include_image: true
  include_depth: false  # Set to true if depth is available
  include_joint_states: true
  include_base_pose: false
  include_task_text: false  # For language-conditioned policies
  history_length: 1  # Number of past observations to include
  topic: "/manipulation/observation"
  sync_tolerance_sec: 0.15  # Sensor sync tolerance (increase for slower cameras, e.g., 10 Hz)

# Action configuration
action:
  output_format: "eef_pose"  # Options: eef_pose, joint_delta, hybrid
  reference_frame: "base_link"  # Frame for EEF targets
  use_base_hint: false  # Whether policy outputs base motion hints
  eef_pose_is_delta: true  # OpenVLA outputs delta poses; set false for absolute targets

# Safety and monitoring
safety:
  confidence_threshold: 0.0  # Minimum confidence to execute action
  timeout_sec: 6.0  # Keep > policy period and remote latency to avoid false safety stops
  log_frequency: 100  # Log every N inferences

# Model-specific parameters (adjust based on your chosen model)
openvla:
  tokenizer_path: ""  # Auto-download if empty
  max_length: 512
  temperature: 1.0
  top_p: 0.9

lerobot:
  policy_name: "act"  # Options: act, diffusion, etc.
  pretrained_path: ""
  n_action_steps: 10
